<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Shader 1</title>
	
	<style>
		* { padding: 0; margin: 0; }
		#container { position: fixed; top: 0; bottom: 0; left: 0; right: 0; }
	</style>

	<script src="../three.js"></script>
</head>
<body>
	<div id="container"></div>
	
	<script id="vs" type="x-shader/x-vertex">
		uniform float time;
		
		attribute float size;
		attribute vec4 color;

		varying vec4 vColor;

		void main() {
			vColor = color;

			vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			gl_PointSize = size * ( 200.0 / -mvPosition.z );
			gl_Position = projectionMatrix * mvPosition;
		}
	</script>

	<script id="fs" type="x-shader/x-fragment">
		uniform float time;

		varying vec4 vColor;

		void main (void) {
			gl_FragColor = vColor * abs(sin(time));
		}
	</script>

	<script>
		
	var container, camera, renderer, scene, mesh, uniforms;
	var W = window.innerWidth;
	var H = window.innerHeight;

	init();
	animate();

	function init() {

		container = document.getElementById( 'container' );

		camera = new THREE.PerspectiveCamera( 45, W / H, 1, 1000 );
		camera.position.z = 10;

		scene = new THREE.Scene();

		var geometry = new THREE.BufferGeometry();
		
		var vertices = new Float32Array([
			-1.0, -1.0,  1.0,
			 0.0, -1.0,  1.0,
			 1.0, -1.0,  1.0,
			 0.0,  0.0,  0.0,
			 1.0,  1.0,  1.0,
			 0.0,  1.0,  1.0, 
			-1.0,  1.0,  1.0, 
			]);

		var colors = new Float32Array([
				255.0, 0.0, 0.0, 0.75,
				0.0, 255.0, 0.0, 0.75,
				0.0, 0.0, 255.0, 0.75,
				255.0, 255.0, 255.0, 0.95,
				255.0, 0.0, 0.0, 0.75,
				0.0, 255.0, 0.0, 0.75,
				0.0, 0.0, 255.0, 0.75,
			]);

		var sizes = new Float32Array([
			2, 2, 2, 5, 2, 2, 2
			]);

		geometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );
		geometry.addAttribute( 'color', new THREE.BufferAttribute( colors, 4 ) );
		geometry.addAttribute( 'size', new THREE.BufferAttribute( sizes, 1 ) );

		var material = new THREE.PointsMaterial({ 
			color: 0xff0000, 
			side: THREE.DoubleSide
		});

		uniforms = { time: { type: 'f', value: 1.0 } };

		var shaderMaterial = new THREE.ShaderMaterial({
			uniforms: uniforms,
			vertexShader: document.getElementById( 'vs' ).textContent,
			fragmentShader: document.getElementById( 'fs' ).textContent,
			blending: THREE.AdditiveBlending,
			transparent: true,
			depthTest: false,
		});
		
		mesh =  new THREE.Points( geometry, shaderMaterial );

		scene.add( mesh );

		renderer = new THREE.WebGLRenderer();
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setClearColor( 0x141823 );

		container.appendChild( renderer.domElement );

		onWindowResize();

		window.addEventListener( 'resize', onWindowResize, false );
	}

	function onWindowResize( event ) {

		W = window.innerWidth;
		H = window.innerHeight;
		
		camera.aspect = W / H;
		camera.updateProjectionMatrix();

		renderer.setSize( W, H );
	}

	function animate() {

		requestAnimationFrame( animate );
		render();
	}

	function render() {

		mesh.rotation.y += 0.05;
		mesh.rotation.x -= 0.05;
		uniforms.time.value += 0.05;
		renderer.render( scene, camera );
	}

	</script>
</body>
</html>